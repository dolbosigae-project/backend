<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gae.mapper.ABMapper">
    
    <!-- Result Map -->
    <resultMap id="ABMap" type="com.gae.dto.ABDTO">
        <id column="AB_ID" property="abID"/>
        <result column="SH_ID" property="shID"/>
        <result column="AB_DATE" property="abDate"/>
        <result column="AB_LOCATION" property="abLocation"/>
        <result column="AB_STATUS" property="abStatus"/>
        <result column="AB_BREED" property="abBreed"/>
        <result column="AB_GENDER" property="abGender"/>
        <result column="AB_AGE" property="abAge"/>
        <result column="AB_WEIGHT" property="abWeight"/>
        <result column="AB_COLOR" property="abColor"/>
        <result column="AB_RESCUED" property="abRescued"/>
        <result column="AB_CHARACTER" property="abCharacter"/>
        <result column="AB_IMG" property="abImg"/>
        <result column="AB_REGION" property="abRegion"/>
    </resultMap>

    <!-- 전체 조회 -->
    <select id="getABList" parameterType="map" resultMap="ABMap">
        <![CDATA[
        SELECT * FROM (
            SELECT a.*, ROW_NUMBER() OVER (ORDER BY AB_ID) AS rnum
            FROM AB a
        ) WHERE rnum BETWEEN #{startRow} AND #{endRow}
        ]]>
    </select>

    <!-- 필터링된 부분 조회 -->
    <select id="searchAB" parameterType="map" resultMap="ABMap">
        <![CDATA[
        SELECT * FROM (
            SELECT ROWNUM AS rnum, a.*
            FROM (SELECT * FROM AB
                  WHERE AB_REGION LIKE '%' || #{region, jdbcType=VARCHAR} || '%'
                  AND AB_BREED LIKE '%' || #{breed, jdbcType=VARCHAR} || '%'
                  ORDER BY AB_ID) a
            WHERE ROWNUM <= #{endRow}
        )
        WHERE rnum >= #{startRow}
        ]]>
    </select>

    <!-- 전체 데이터 카운트 -->
    <select id="getTotalCount" resultType="int">
        <![CDATA[
        SELECT COUNT(*) FROM AB
        ]]>
    </select>

    <!-- 필터링된 데이터 카운트 -->
    <select id="getTotalCountBySearch" parameterType="map" resultType="int">
        <![CDATA[
        SELECT COUNT(*) FROM AB
        WHERE AB_REGION LIKE '%' || #{region, jdbcType=VARCHAR} || '%'
        AND AB_BREED LIKE '%' || #{breed, jdbcType=VARCHAR} || '%'
        ]]>
    </select>

    <!-- ID로 조회 -->
    <select id="selectABDetail" parameterType="string" resultMap="ABMap">
        <![CDATA[
        SELECT * FROM AB WHERE AB_ID = #{id}
        ]]>
    </select>

    <!-- AB 데이터 추가 -->
    <insert id="insertAB" parameterType="com.gae.dto.ABDTO">
        <![CDATA[
        INSERT INTO AB (
            AB_ID, SH_ID, AB_DATE, AB_LOCATION, AB_STATUS, AB_BREED, AB_GENDER,
            AB_AGE, AB_WEIGHT, AB_COLOR, AB_RESCUED, AB_CHARACTER, AB_IMG, AB_REGION
        ) VALUES (
            #{abID}, #{shID}, #{abDate}, #{abLocation}, #{abStatus}, #{abBreed}, #{abGender},
            #{abAge}, #{abWeight}, #{abColor}, #{abRescued}, #{abCharacter}, #{abImg}, #{abRegion}
        )
        ]]>
    </insert>

    <!-- AB 데이터 삭제 -->
    <delete id="deleteAB" parameterType="string">
        <![CDATA[
        DELETE FROM AB WHERE AB_ID = #{id}
        ]]>
    </delete>

</mapper>
